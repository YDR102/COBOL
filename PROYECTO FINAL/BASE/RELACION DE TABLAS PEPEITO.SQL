-- DROP TABLE IF EXISTS COMPANIAS_SEGUROS;
-- DROP TABLE IF EXISTS PERITOS_PEPITO_SEG;
-- DROP TABLE IF EXISTS SINIESTROS_PEPITO_SEG;
-- DROP TABLE IF EXISTS SEGURO_PEPITO_SEG;
-- DROP TABLE IF EXISTS COMPANIAS_PEPITO_SEG;
-- DROP TABLE IF EXISTS CLIENTES_PEPITO_SEG

CREATE TABLE CLIENTES_PEPITO_SEG
(
    DNI_CL CHAR(09) NOT NULL,
    NOMBRE_CL CHAR(25) NOT NULL,
    APELLIDO_1 CHAR(25) NOT NULL,
    APELLIDO_2 CHAR(25) NOT NULL,
    CLASE_VIA CHAR(25) NOT NULL,
    NOMBRE_VIA CHAR(55) NOT NULL,
    NUMERO_VIA INT NOT NULL,
    COD_POSTAL CHAR(05) NOT NULL,
    CIUDAD CHAR(25) NOT NULL,
    TELEFONO CHAR(10) NOT NULL,
    OBSERVACIONES VARCHAR(500) NULL,
    CONSTRAINT PK_DNI_CL PRIMARY KEY (DNI_CL)
);

CREATE UNIQUE INDEX IDX_DNI_CL ON CLIENTES_PEPITO_SEG (DNI_CL);

CREATE TABLE SEGUROS_PEPITO_SEG
(
    NUMERO_POLIZA CHAR(09) NOT NULL,
    TIPO CHAR(2) NOT NULL,
    -- CHECK (TIPO IN ('01', '02', '03')),
    FECHA_INICIO DATE NOT NULL,
    FECHA_VENCIMIENTO DATE NOT NULL,
    COND_PART VARCHAR(2000) NOT NULL,
    OBSERVACIONES VARCHAR(500) NULL,
    DNI_CL CHAR(09) NOT NULL,
    CONSTRAINT PK_NUMERO_POLIZA PRIMARY KEY (NUMERO_POLIZA),
    FOREIGN KEY (DNI_CL) REFERENCES CLIENTES_PEPITO_SEG(DNI_CL),
    CONSTRAINT CHK_TIPO 
    CHECK 
    (TIPO IS NOT NULL AND TIPO = '01' OR TIPO = '02' OR TIPO = '03')
);

CREATE UNIQUE INDEX IDX_NUMERO_POLIZA 
ON SEGUROS_PEPITO_SEG (NUMERO_POLIZA);

CREATE TABLE SINIESTROS_PEPITO_SEG
(
    ID_SINIETRO INT NOT NULL,
    FECHA_SINIESTRO DATE NOT NULL,
    CAUSAS CHAR(55) NOT NULL,
    ACPTADO CHAR(01) NOT NULL CHECK (ACPTADO IN ('N', 'S')),
    INDEMNIZACION DECIMAL(15,2) NOT NULL,
    NUMERO_POLIZA CHAR(09) NOT NULL,
    DNI_PERITO CHAR(09) NOT NULL,
    CONSTRAINT PK_ID_SINIETRO PRIMARY KEY (ID_SINIETRO),
    FOREIGN KEY (NUMERO_POLIZA) 
    REFERENCES SEGUROS_PEPITO_SEG(NUMERO_POLIZA)
);

CREATE UNIQUE INDEX IDX_ID_SINIETRO 
ON SINIESTROS_PEPITO_SEG (ID_SINIETRO);

CREATE TABLE COMPANIAS_SEGUROS
(
    ID INT NOT NULL,
    NUMERO_POLIZA CHAR(09) NOT NULL,
    NOMBRE_COMPANIA CHAR(25) NOT NULL,
    CONSTRAINT PK_ID PRIMARY KEY (ID),
    FOREIGN KEY (NUMERO_POLIZA) 
    REFERENCES SEGUROS_PEPITO_SEG(NUMERO_POLIZA),
    UNIQUE (NUMERO_POLIZA, NOMBRE_COMPANIA)
);

CREATE UNIQUE INDEX IDX_ID 
ON COMPANIAS_SEGUROS (ID);
